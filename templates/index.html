<!DOCTYPE html>
<html>
<head>
    <title>Document Intelligence RAG</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='style.css') }}">
</head>

<body>

<div class="main">

    <h1>ðŸ“„ Document Intelligence RAG</h1>
    <p class="subtitle">Ask questions about your PDF using AI</p>

    <div class="card">
        <h3>Upload Document</h3>

        <form id="uploadForm" enctype="multipart/form-data">
            <input type="file" name="pdf" id="pdfFile" required>
            <button type="submit">Upload PDF</button>
        </form>

        <div class="progress-container" id="progressContainer">
            <div class="progress-bar" id="progressBar"></div>
        </div>

        <p id="status"></p>
    </div>

    <!-- Query Section -->
    <div class="card">
        <h3>Ask a Question</h3>

        <form id="queryForm">
            <input type="text" id="queryInput" placeholder="Type your question..." required>
            <button type="submit">Get Answer</button>
        </form>
    </div>

    <!-- Chat Area -->
    <div id="chatArea"></div>

</div>

<script>
/* ---------------- UPLOAD LOGIC ---------------- */
const uploadForm = document.getElementById("uploadForm");
const progressBar = document.getElementById("progressBar");
const progressContainer = document.getElementById("progressContainer");
const statusText = document.getElementById("status");

uploadForm.addEventListener("submit", function(e) {
    e.preventDefault();

    const file = document.getElementById("pdfFile").files[0];
    if (!file) return;

    const formData = new FormData();
    formData.append("pdf", file);

    const xhr = new XMLHttpRequest();
    progressContainer.style.display = "block";

    xhr.upload.addEventListener("progress", function(e) {
        if (e.lengthComputable) {
            let percent = (e.loaded / e.total) * 100;
            progressBar.style.width = percent + "%";
        }
    });

    xhr.onload = function() {
        statusText.innerText = "âœ… Upload & Processing Complete!";
    };

    xhr.open("POST", "/upload");
    xhr.send(formData);
});


/* ---------------- QUERY LOGIC ---------------- */
const queryForm = document.getElementById("queryForm");
const chatArea = document.getElementById("chatArea");

queryForm.addEventListener("submit", function(e) {
    e.preventDefault();

    const query = document.getElementById("queryInput").value;

    if (!query) return;

    // Show user message
    chatArea.innerHTML += `
        <div class="chat">
            <div class="user-msg"><b>You:</b> ${query}</div>
            <div class="bot-msg" id="loading">Thinking...</div>
        </div>
    `;

    fetch("/ask", {
        method: "POST",
        headers: {"Content-Type": "application/json"},
        body: JSON.stringify({query: query})
    })
    .then(res => res.json())
    .then(data => {
        document.getElementById("loading").innerHTML =
            "<b>AI:</b> " + data.answer;
    });

    queryForm.reset();
});
</script>

</body>
</html>
